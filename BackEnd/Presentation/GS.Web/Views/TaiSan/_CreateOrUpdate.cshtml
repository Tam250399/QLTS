@model TaiSanModel
@{
    decimal iKH_TY_LE = 0;
    decimal iKH_THOI_HAN_SU_DUNG = 0;
    bool isLoaiTaiSanModelNull = Model.LoaiTaiSanModel == null;
    if (Model.LoaiTaiSanModel != null)
    {
        iKH_TY_LE = (decimal)Model.LoaiTaiSanModel.KH_TY_LE;
        iKH_THOI_HAN_SU_DUNG = (decimal)Model.LoaiTaiSanModel.KH_THOI_HAN_SU_DUNG;
    }
}
<script>
    class CreateOrUpdateTaiSanJS {
        constructor(fullValid) {
            this.checkValid = false;//có lỗi valid trên form: true, ngược lại: false
            this.initEvents();
            this.messageAlert = "";
            this.fullValid = {
                NS_And_NguonVon: false,
                ODA_And_NguonVon: false,
                VTPCP_And_NguonVon: false,
                NgaySD_And_NgayNhap: false,
                NgaySD_And_NgayQD: false,
                HienTrang_Dien_tich: false,
                Empty: false,
                NamXayDung: false,
                KHNgayBatDau_And_NgaySD: false,
                DiaChi_TS_Nha: false,
                Oto_ChucDanh: false,
                NguyenGia_TSQL: false,
                NguyenGia_10M: false
            }
        }

        initEvents() {
            var classJSThis = this;
            // add text cho span check valid TSQL
            let spanValidateTSQL = $('#span_NguyenGiaTSQL');
            let spanValidateNG10m = $('#span_NguyenGia10m')
            if (spanValidateTSQL) {
                spanValidateTSQL.html(' Nguyên giá của TS quản lý như TSCĐ phải >= 5.000.000 và nhỏ hơn 10.000.000');
                spanValidateTSQL.hide();
            }
            if (spanValidateNG10m) {
                spanValidateNG10m.html(' Nguyên giá của TSCĐ phải >= 10.000.000');
                spanValidateNG10m.hide();
            }

            // check địa chỉ trên form nhà
            $('.isQuanLyDatClass').change(() => {
                let valueCheck = $('input[name=isQuanLyDatName]:checked').val();
                //nếu là quản lý đất thì cho chọn đất
                debugger;
                if (valueCheck == "true") {
                    //bắt phải chọn đất
                    classJSThis.fullValid.DiaChi_TS_Nha = false;
                    $('#div_ChonDat').show();
                    $('#div_ChonDiaBan').hide();
                    $("#taisannhaModel_NHA_DIA_CHI").prop('disabled', true);
                    $("#taisannhaModel_NHA_DIA_CHI").prop('placeholder', "");
                    if (!($("#taisannhaModel_TAI_SAN_DAT_ID").val() > 0)) {
                        $("#taisannhaModel_TAI_SAN_DAT_ID").val('');
                        $("#btnGoDat").hide();
                    }
                    else {
                        $("#btnGoDat").show();
                    }
                    $("#isQuanLyDatLabel").text('Thuộc khuôn viên đất');
                    $('#checkdiachi').text('Phải chọn khuôn viên đất')

                } else {
                    //let IdXa = $('#taisannhaModel_NHA_XaId').val();
                    //if (IdXa <= 0) {
                    //    classJSThis.fullValid.DiaChi_TS_Nha = true;
                    //    showInvalidMessage('taisannhaModel.NHA_XaId', 'Bạn phải chọn thông tin xã!');
                    //}
                    //cho nhập địa chỉ đất
                    $('#div_ChonDat').hide();
                    $('#div_ChonDiaBan').show();
                    $("#btnGoDat").click();
                    $("#isQuanLyDatLabel").text('Địa chỉ nhà');
                    $('#checkdiachi').text('Phải nhập địa chỉ nhà')
                    $("#taisannhaModel_NHA_DIA_CHI").prop('placeholder', "Nhập số nhà, đường phố, tổ / thôn / xóm");
                }
                $('#taisannhaModel_NHA_DIA_CHI').change();
            })
            //$('#taisannhaModel_NHA_XaId').on('change focusout', function () {
            //    if ($(this).val() > 0) {
            //        classJSThis.fullValid.DiaChi_TS_Nha = false;
            //        hideValmsg('taisannhaModel.NHA_XaId');
            //    }
            //    else {
            //        classJSThis.fullValid.DiaChi_TS_Nha = true;
            //        showInvalidMessage('taisannhaModel.NHA_XaId', 'Bạn phải chọn thông tin xã!');
            //    }

            //})
            //Lý do tăng change
            $("#LY_DO_BIEN_DONG_ID").change(this.displayFieldsWhenLyDoBienDongChange);
            this.displayFieldsWhenLyDoBienDongChange();
            //Xử lý mở nhiều popup
            $(document).on({
                'show.bs.modal': function () {
                    var zIndex = 1040 + (10 * $('.modal:visible').length);
                    $(this).css('z-index', zIndex);
                    setTimeout(function () {
                        $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');
                    }, 0);
                },
                'hidden.bs.modal': function () {
                    if ($('.modal:visible').length > 0) {
                        // restore the modal-open class to the body element, so that scrolling works
                        // properly after de-stacking a modal.
                        setTimeout(function () {
                            $(document.body).addClass('modal-open');
                        }, 0);
                    }
                }
            }, '.modal');
            //$("#NGAY_NHAP").change(this.loadLoaiTaiSan);
            //------------------------------------sự kiện các giá trị tài sản
            $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.NGAN_SACH)").data("kendoNumericTextBox").enable(false);
            //---------------------------
            $("#TongNguyenGia").change(function () {
                var val = $('#TongNguyenGia').val();

                classJSThis.CheckNguyenGiaTSQL();
                $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.NGAN_SACH)").data("kendoNumericTextBox").value(val);
                $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)").data("kendoNumericTextBox").value(0);
                if (@Model.IsBanQuanLyDuAn.ToString().ToLower() == true) {
                    $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.VTPCP)").data("kendoNumericTextBox").value(0);
                    $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.ODA)").data("kendoNumericTextBox").value(0);
                }
            });
            if (@Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAT)) {
                let dpkNgayNhap = $('#NGAY_NHAP').data("kendoDatePicker");
                let dpkNgaySuDung = $('#NGAY_SU_DUNG').data("kendoDatePicker");
                dpkNgayNhap.bind("change", this.compareDateNgaySDandNgayTang.bind(this));
                dpkNgaySuDung.bind("change", this.compareDateNgaySDandNgayTang.bind(this));
                if (@Model.isTangMoi.ToString().ToLower() == false) {
                    dpkNgayNhap.enable(false);
                }
            }


            //------xử lý sự kiện form nguồn vốn

            let txtTongNG = $("#TongNguyenGia").data("kendoNumericTextBox");
            let txtNguonVonKhac = $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)").data("kendoNumericTextBox");
            let txtNguonVonNS = $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.NGAN_SACH)").data("kendoNumericTextBox");
            if (@Model.IsBanQuanLyDuAn.ToString().ToLower() == true) {
                let txtNguonVonVienTroPhiCP = $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.VTPCP)").data("kendoNumericTextBox");
                let txtNguonVonODA = $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.ODA)").data("kendoNumericTextBox");

                if (txtTongNG && txtNguonVonKhac && txtNguonVonNS && txtNguonVonVienTroPhiCP && txtNguonVonODA) {
                    txtNguonVonVienTroPhiCP.bind('change', () => {
                        var tongNG = txtTongNG.value();
                        var nguonNS = txtNguonVonNS.value();
                        var nguonVTPCP = txtNguonVonVienTroPhiCP.value();
                        var nguonVonKhac = txtNguonVonKhac.value();
                        var nguonVonODA = txtNguonVonODA.value();
                        var tongNguonVon = nguonNS + nguonVTPCP + nguonVonODA + nguonVonKhac;
                        if (tongNG > 0 && nguonNS > 0 && nguonVTPCP > 0) {
                            if (nguonVTPCP > nguonNS) {
                                showInvalidMessage('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.VTPCP)', 'Tổng các nguồn vốn phải bằng nguyên giá.');
                                classJSThis.checkValid = true;
                                classJSThis.fullValid.VTPCP_And_NguonVon = true;
                            } else {
                                hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.VTPCP)');
                                classJSThis.checkValid = false;
                                classJSThis.fullValid.VTPCP_And_NguonVon = false;
                                var newNguonNS = parseInt(tongNG - nguonVTPCP - nguonVonKhac - nguonVonODA);
                                txtNguonVonNS.value(newNguonNS);
                                txtNguonVonNS.trigger('change');
                            }
                        }
                        else {
                            txtNguonVonVienTroPhiCP.value(0);
                            txtNguonVonNS.value(tongNG - nguonVonODA - nguonVonKhac);
                            hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.VTPCP)');
                            classJSThis.checkValid = false;
                            classJSThis.fullValid.NS_And_NguonVon = false;
                        }
                    })
                    txtNguonVonODA.bind('change', () => {
                        var tongNG = txtTongNG.value();
                        var nguonNS = txtNguonVonNS.value();
                        var nguonVTPCP = txtNguonVonVienTroPhiCP.value();
                        var nguonVonKhac = txtNguonVonKhac.value();
                        var nguonVonODA = txtNguonVonODA.value();
                        var tongNguonVon = nguonNS + nguonVTPCP + nguonVonODA + nguonVonKhac;
                        if (tongNG > 0 && nguonNS > 0 && nguonVonODA > 0) {
                            if (nguonVonODA > nguonNS) {
                                showInvalidMessage('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.ODA)', 'Tổng các nguồn vốn phải bằng nguyên giá.');
                                classJSThis.checkValid = true;
                                classJSThis.fullValid.ODA_And_NguonVon = true;
                            } else {
                                hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.ODA)');
                                classJSThis.checkValid = false;
                                classJSThis.fullValid.ODA_And_NguonVon = false;
                                var newNguonNS = parseInt(tongNG - nguonVTPCP - nguonVonKhac - nguonVonODA);
                                txtNguonVonNS.value(newNguonNS);
                                txtNguonVonNS.trigger('change');
                            }
                        }
                        else {
                            txtNguonVonODA.value(0);
                            txtNguonVonNS.value(tongNG - nguonVTPCP - nguonVonKhac);
                            hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DU_AN.ODA)');
                            classJSThis.checkValid = false;
                            classJSThis.fullValid.NS_And_NguonVon = false;
                        }
                    })

                    txtNguonVonKhac.bind('change', () => {
                        var tongNG = txtTongNG.value();
                        var nguonNS = txtNguonVonNS.value();
                        var nguonVTPCP = txtNguonVonVienTroPhiCP.value();
                        var nguonVonKhac = txtNguonVonKhac.value();
                        var nguonVonODA = txtNguonVonODA.value();
                        var tongNguonVon = nguonNS + nguonVTPCP + nguonVonODA + nguonVonKhac;
                        if (tongNG > 0 && nguonNS > 0 && nguonVonKhac > 0) {
                            if (nguonVonKhac > nguonNS) {
                                showInvalidMessage('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)', 'Tổng các nguồn vốn phải bằng nguyên giá.');
                                classJSThis.checkValid = true;
                                classJSThis.fullValid.ODA_And_NguonVon = true;
                            } else {
                                hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)');
                                classJSThis.checkValid = false;
                                classJSThis.fullValid.ODA_And_NguonVon = false;
                                var newNguonNS = parseInt(tongNG - nguonVTPCP - nguonVonKhac - nguonVonODA);
                                txtNguonVonNS.value(newNguonNS);
                                txtNguonVonNS.trigger('change');
                            }
                        }
                        else {
                            txtNguonVonODA.value(0);
                            txtNguonVonNS.value(tongNG - nguonVTPCP - nguonVonKhac - nguonVonODA);
                            hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)');
                            classJSThis.checkValid = false;
                            classJSThis.fullValid.NS_And_NguonVon = false;
                        }
                    })
                }
            } else {
                if (txtNguonVonKhac && txtNguonVonNS && txtTongNG) {
                    txtNguonVonKhac.bind('change', () => {
                        var tongNG = txtTongNG.value();
                        var nguonNS = txtNguonVonNS.value();
                        var nguonVonKhac = txtNguonVonKhac.value();
                        if (tongNG > 0 && nguonVonKhac > 0) {
                            if (nguonVonKhac > tongNG) {
                                showInvalidMessage('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)', 'Tổng các nguồn vốn phải bằng nguyên giá.');
                                classJSThis.checkValid = true;
                                classJSThis.fullValid.NS_And_NguonVon = true;
                            } else {
                                hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)');
                                classJSThis.checkValid = false;
                                classJSThis.fullValid.NS_And_NguonVon = false;
                                var newNguonNS = parseInt(tongNG - nguonVonKhac);
                                txtNguonVonNS.value(newNguonNS);
                                txtNguonVonNS.trigger('change');
                            }
                        }
                        else {
                            txtNguonVonKhac.value(0);
                            txtNguonVonNS.value(tongNG);
                            hideValmsg('NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)');
                            classJSThis.checkValid = false;
                            classJSThis.fullValid.NS_And_NguonVon = false;
                        }
                    })
                }
            }

            //---------------
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC)) {
                //check cho ngoi va tai trong

                $(document).on("focusout", "#taisanOtoModel_SO_CHO_NGOI", { input: "#taisanOtoModel_SO_CHO_NGOI", disableInput: "#taisanOtoModel_TAI_TRONG" }, enableInput);
                $(document).on("focusout", "#taisanOtoModel_TAI_TRONG", { input: "#taisanOtoModel_TAI_TRONG", disableInput: "#taisanOtoModel_SO_CHO_NGOI" }, enableInput);
            }

            //-------sự kiện trên form oto, phương tiện vận tải khác
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.OTO) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC)) {
                //check cho ngoi va tai trong

                //$(document).on("focusout", "#taisanOtoModel_SO_CHO_NGOI", { input: "#taisanOtoModel_SO_CHO_NGOI", disableInput: "#taisanOtoModel_TAI_TRONG" }, enableInput);
                //$(document).on("focusout", "#taisanOtoModel_TAI_TRONG", { input: "#taisanOtoModel_TAI_TRONG", disableInput: "#taisanOtoModel_SO_CHO_NGOI" }, enableInput);
                $(document).on("change", "#taisanOtoModel_NHAN_XE_ID", this.prepareDDLDongXeByNhanXeId);
                $("#NGAY_SU_DUNG").change(function () {
                    let ngaysudung = $('#NGAY_SU_DUNG').val();
                    if (ngaysudung) {
                        var temp = ngaysudung.split('/');
                        let namSX = $("#NAM_SAN_XUAT").val();
                        if (!(namSX > 0) || namSX > temp[2]) {
                            $("#NAM_SAN_XUAT").val(temp[2]);
                        }
                    }
                });
                //$()
            }
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) {
                //check cho ngoi va tai trong
                $("#TongNguyenGia").data("kendoNumericTextBox").value(10000000);
                $("#TongNguyenGia").data("kendoNumericTextBox").enable(false);
                $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.NGAN_SACH)").data("kendoNumericTextBox").value(10000000);
                $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)").data("kendoNumericTextBox").value(0);
                $("#nvYeuCauChiTietModel_HM_GIA_TRI_CON_LAI").data("kendoNumericTextBox").value(10000000);
            }
            //--------sự kiện trên form đất
            //$("#taisandatModel_HS_QUYET_DINH_GIAO_NGAY").change(this.compareDateNgaySDandNgayQD.bind(this));
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.DAT)) {
                //$(document).on("change focusout", "#taisandatModel_DAT_DIEN_TICH", {
                //    selectorDienTich: '#taisandatModel_DAT_DIEN_TICH', data_valmsg_for: 'taisandatModel.DIEN_TICH', valmsg: 'Diện tích đất phải bằng tổng hiện trạng sử dụng'
                //}, this.compareHientrang.bind(this));
                $(document).on("change focusout", "#taisandatModel_DAT_DIEN_TICH", {
                    selectorDienTich: '#taisandatModel_DAT_DIEN_TICH', data_valmsg_for: 'taisandatModel.DIEN_TICH', valmsg: 'Diện tích đất phải bằng tổng hiện trạng sử dụng'
                }, this.compareHientrang.bind(this));
                $(document).on("change focusout", ".HienTrang", {
                    selectorDienTich: '#taisandatModel_DAT_DIEN_TICH', data_valmsg_for: 'taisandatModel.DIEN_TICH', valmsg: 'Diện tích đất phải bằng tổng hiện trạng sử dụng'
                }, this.compareHientrang.bind(this));
                $("#GiaTriQSDDat").change(function () {
                    var val = $(this).val();
                    $("#TongNguyenGia").data("kendoNumericTextBox").value(val);
                    $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.NGAN_SACH)").data("kendoNumericTextBox").value(val);
                    $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.KHAC)").data("kendoNumericTextBox").value(0);
                });

                //let ngayQD = $("#taisandatModel_HS_QUYET_DINH_GIAO_NGAY").data("kendoDatePicker");
                //    ngayQD.bind("change", this.compareDateNgaySDandNgayQD.bind(this));;

                // dpkNgaySuDung.bind("change", this.compareDateNgaySDandNgayQD.bind(this));
                //$("#checkbox-hosogiayto").click(this.compareDateNgaySDandNgayQD.bind(this));

            }
            //--------sự kiện trên form nhà
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.NHA)) {
                //$(document).on("change focusout", "#taisannhaModel_DIEN_TICH_SAN_XAY_DUNG", {
                //    selectorDienTich: '#taisannhaModel_DIEN_TICH_SAN_XAY_DUNG', data_valmsg_for: 'taisannhaModel.DIEN_TICH_SAN_XAY_DUNG', valmsg: 'DT sàn sử dụng phải bằng tổng hiện trạng sử dụng'
                //}, this.compareHientrang.bind(this));
                $(document).on("change focusout", ".HienTrang", {
                    selectorDienTich: '#taisannhaModel_DIEN_TICH_SAN_XAY_DUNG', data_valmsg_for: 'taisannhaModel.DIEN_TICH_SAN_XAY_DUNG', valmsg: 'DT sàn sử dụng phải bằng tổng hiện trạng sử dụng'
                }, this.compareHientrang.bind(this));
                $(document).on('change focusout', '#taisannhaModel_NHA_DIA_CHI', { selectorCheck: '#taisannhaModel_NHA_DIA_CHI', data_valmsg_for: 'taisannhaModel.NHA_DIA_CHI', valmsg: 'Mời nhập địa chỉ hoặc chọn đất.' }, this.checkNullOrEmptySelector.bind(this));
                //gỡ đất
                $("#btnGoDat").click(function (e) {
                    $("#btnGoDat").addClass('disabled');
                    $("#btnGoDat").hide();
                    $("#taisannhaModel_TAI_SAN_DAT_ID").val(null);
                    $("#taisannhaModel_NHA_DIA_CHI").val(null);
                    $("#taisannhaModel_NHA_DIA_CHI").prop("disabled", false);
                    $("#taisannhaModel_NHA_DIA_CHI").trigger("change");
                });
            }
            //--------sự kiện trên form vật kiến trúc
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.TAI_SAN_VAT_KIEN_TRUC)) {
                $(document).on('change', '#TongNguyenGia', this.checkGiaTriPerDvt_vkt.bind(this));

                $(document).on("focusout", "#taisanVktModel_VKT_DIEN_TICH", { input: "#taisanVktModel_VKT_DIEN_TICH", disableInput: "#taisanVktModel_THE_TICH" }, enableInput);
                $(document).on("focusout", "#taisanVktModel_VKT_DIEN_TICH", { input: "#taisanVktModel_VKT_DIEN_TICH", disableInput: "#taisanVktModel_CHIEU_DAI" }, enableInput);
                $(document).on("focusout", "#taisanVktModel_THE_TICH", { input: "#taisanVktModel_THE_TICH", disableInput: "#taisanVktModel_VKT_DIEN_TICH" }, enableInput);
                $(document).on("focusout", "#taisanVktModel_THE_TICH", { input: "#taisanVktModel_THE_TICH", disableInput: "#taisanVktModel_CHIEU_DAI" }, enableInput);
                $(document).on("focusout", "#taisanVktModel_CHIEU_DAI", { input: "#taisanVktModel_CHIEU_DAI", disableInput: "#taisanVktModel_VKT_DIEN_TICH" }, enableInput);
                $(document).on("focusout", "#taisanVktModel_CHIEU_DAI", { input: "#taisanVktModel_CHIEU_DAI", disableInput: "#taisanVktModel_THE_TICH" }, enableInput);
                $(document).on("change", "#taisanVktModel_VKT_DIEN_TICH", this.checkGiaTriPerDvt_vkt.bind(this));
                $(document).on("change", "#taisanVktModel_THE_TICH", this.checkGiaTriPerDvt_vkt.bind(this));
                $(document).on("change", "#taisanVktModel_CHIEU_DAI", this.checkGiaTriPerDvt_vkt.bind(this));
            }
            if (@Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAT) && @Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) {
                if ($("#checktinhkhauhao").is(":checked")) {
                    $("#tinhkhauhao").show();
                }
                let dpkNgayKhauHao = $('#nvYeuCauChiTietModel_KH_NGAY_BAT_DAU').data("kendoDatePicker");
                if (dpkNgayKhauHao) {
                    dpkNgayKhauHao.bind("change", this.compareDateNgayKHandNgaySD.bind(this));
                }
                $("#NGAY_SU_DUNG").change(tinhGiaTriTaiSan);
                $("#NGAY_NHAP").change(tinhGiaTriTaiSan);
                $("#LOAI_TAI_SAN_ID").change(tinhGiaTriTaiSan);
                $("#LOAI_TAI_SAN_ID").change(this.getThongTinHM);
                $("#nvYeuCauChiTietModel_KH_GIA_TINH_KHAU_HAO").change(tinhGiaTriTaiSan);
                $("#nvYeuCauChiTietModel_KH_THANG_CON_LAI").change(tinhGiaTriTaiSan);
                $("#TongNguyenGia").change(tinhGiaTriTaiSan);
                $("#nvYeuCauChiTietModel_KH_NGAY_BAT_DAU").change(tinhGiaTriTaiSan);
                $("#nvYeuCauChiTietModel_KH_TY_LE_NGUYEN_GIA_KHAU_HAO").change(tinhGiaTriTaiSan);
                $("#KH_TiLe").change(tinhGiaTriTaiSan);
                //$("#LY_DO_BIEN_DONG_ID").change(this.displayFieldForTSKKThua);
                //               this.displayFieldForTSKKThua();
                if (@(Model.HM_TY_LE ?? 0) == 0) {
                    this.getThongTinHM();
                }
            }
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) {
                $("#nvYeuCauChiTietModel_HM_GIA_TRI_CON_LAI").data("kendoNumericTextBox").readonly();
            }
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.VO_HINH)) {
                $("#LOAI_TAI_SAN_DON_VI_ID").change(this.getThongTinHM);
                if (@(Model.HM_TY_LE ?? 0) == 0) {
                    this.getThongTinHM();
                }
            }
    @*if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) {
                $("#NguonVon_@((int)GS.Core.Domain.DanhMuc.enumNGUON_VON_DEFAULT.NGAN_SACH)").data("kendoNumericTextBox").value(10000000);
                }*@
                                                                                                                            if ($("#checktinhkhauhao").is(":checked")) { $("#tinhkhauhao").show(); }
            /*
            * validator popup thêm mới bộ phận sử dụng bị đè xuống đất nên ẩn tạm thời validate
            * kiểm tra sau khi đóng popup các trường hiển thị có dữ liệu hay ko
            */
            $("#globalModalIframeClose").click(function () {
                $(".TEN").hide();
            });

        }

        prepareDDLDongXeByNhanXeId() {
            var nhanXeId = $(this).val();
            var url = "/DongXe/GetDongXesByNhanXeId?nhanXeId=" + nhanXeId;
            var getListNhanXe = ajaxGet(url);
            getListNhanXe.done(function (result) {
                var dropdownlistOto = $("#taisanOtoModel_DONG_XE_ID").data("kendoDropDownList");
                dropdownlistOto.setDataSource(new kendo.data.DataSource({ data: result }));
                dropdownlistOto.select(0);

            }).fail(function (jqXHR, textStatus, errorThrow) {
                console.log(textStatus + ': ' + errorThrow);
            });
        }

        /**
         * add datasource cho ddlLoaiTaiSan sau khi nhap ngay ke khai
         * tạm thời ngưng sử dụng khi hệ thống chỉ sử dụng 1 chế độ hao mòn theo tt45
         * */
        loadLoaiTaiSan() {
            var ngaynhap = $(this).val(); //$("#NGAY_NHAP").val();
            var _loaihinhTSID = $("#LOAI_HINH_TAI_SAN_ID").val();
            var _data = {
                NgayNhap: ngaynhap,
                loaiHinhTSId: _loaihinhTSID,
            }
            var ajaxRequest = ajaxPost(_data, "/TaiSan/GetLoaiTaiSans", false);
            ajaxRequest.done(function (result) {
                if (_loaihinhTSID == @((int)GS.Core.Domain.DanhMuc.enumLOAI_HINH_TAI_SAN.VO_HINH)) {
                    var ddlLoaiTaiSan = $("#LOAI_TAI_SAN_DON_VI_ID").data("kendoDropDownList");
                    ddlLoaiTaiSan.setDataSource(new kendo.data.DataSource({ data: result }));
                    ddlLoaiTaiSan.value(0);
                    var text = $("#LOAI_TAI_SAN_DON_VI_ID option:first-child ").text();
                    $("#LOAI_TAI_SAN_DON_VI_ID").parent().find(".k-input").text(text);
                }
                else {
                    var ddlLoaiTaiSan = $("#LOAI_TAI_SAN_ID").data("kendoDropDownList");
                    ddlLoaiTaiSan.setDataSource(new kendo.data.DataSource({ data: result }));
                    ddlLoaiTaiSan.value(0);
                    var text = $("#LOAI_TAI_SAN_ID option:first-child ").text();
                    $("#LOAI_TAI_SAN_ID").parent().find(".k-input").text(text);
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                // If fail
                console.log(textStatus + ': ' + errorThrown);
                ShowErrorMessage('Có lỗi xảy ra');
                $(this).removeClass('disabled');
            });
        }
        /**
         * function thực hiện lấy dữ liệu gửi về server
         * */
        addData() {
            var lyDoTangId = $("#LY_DO_BIEN_DONG_ID").val();
            let data;
            getMaByIdLyDoTangGiam(lyDoTangId).done((maLyDo) => {
                var _lstNguonVon = [];
                $(".NguonVon").each(function () {
                    var nguonvonId = $(this).data("idnguonvon");
                    var _tennguonvon = $(this).data("tennguonvon");
                    var _ValueNguonVon = ConvertToNumber("#NguonVon_" + nguonvonId);
                    _lstNguonVon.push({
                        ID: nguonvonId,
                        GiaTri: parseFloat(_ValueNguonVon),
                        TEN: _tennguonvon,
                    });
                });
                var _lstHienTrang = [];
                $(".HienTrang").each(function () {
                    var _hientrangId = $(this).data("idhientrang");
                    var _tenhientrang = $(this).data("tenhientrang");
                    var _kieudulieuid = $(this).data("kieudulieuid");
                    var _nhomHienTrangId = $(this).data("nhomhientrangid");
                    switch (_kieudulieuid) {
                        case 1:
                            var _Value = $("#HienTrang_" + _hientrangId).val();
                            _lstHienTrang.push({
                                HienTrangId: _hientrangId,
                                GiaTriNumber: _Value,
                                TenHienTrang: _tenhientrang,
                                KieuDuLieuId: _kieudulieuid,
                                NhomHienTrangId: _nhomHienTrangId,
                            });
                            break;
                        case 2:
                            var _Value = $("#HienTrang_" + _hientrangId).prop("checked") ? true : false;
                            _lstHienTrang.push({
                                HienTrangId: _hientrangId,
                                GiaTriCheckbox: _Value,
                                TenHienTrang: _tenhientrang,
                                KieuDuLieuId: _kieudulieuid,
                                NhomHienTrangId: _nhomHienTrangId,
                            });
                            break;
                    }
                });
                //Dữ liệu phụ kiện của tài sản hữu hình khác
    @*var _listPhuKien = [];
                    if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)GS.Core.Domain.DanhMuc.enumLOAI_HINH_TAI_SAN.HUU_HINH_KHAC))
                    {
                    $(".danh-sach-phu-kien tr").each(function () {
                    _listPhuKien.push($(this).data("phu-kien"));
                    })
                    } else
                    _listPhuKien = null;*@
                    let isCheckedMienThue = $('#IS_MIEN_THUE').is(':checked');
                let LIST_CHUC_DANH_IDs;

                if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.OTO) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC)) {
                    LIST_CHUC_DANH_IDs = $('#SelectedChucDanhIds').val();
                    if (LIST_CHUC_DANH_IDs != null && LIST_CHUC_DANH_IDs != '' && LIST_CHUC_DANH_IDs != 'undefined') {
                        LIST_CHUC_DANH_IDs = $('#SelectedChucDanhIds').val().toString();
                    } else {
                        LIST_CHUC_DANH_IDs = '';
                    }
                }
                debugger;
                var _data = {
                    ID: $('#@Html.IdFor(c => c.ID)').val(),
                    //MA: COrUTaiSanJS.loadMaTaiSanTuSinh,
                    TEN: $('#@Html.IdFor(c => c.TEN)').val(),
                    isTangMoi: @Model.isTangMoi.ToString().ToLower(),
                    isCreateTSDA: @Model.isCreateTSDA.ToString().ToLower(),
                    LOAI_TAI_SAN_ID: $('#@Html.IdFor(c => c.LOAI_TAI_SAN_ID)').val(),
                    LOAI_TAI_SAN_DON_VI_ID: $('#@Html.IdFor(c => c.LOAI_TAI_SAN_DON_VI_ID)').val(),
                    LOAI_HINH_TAI_SAN_ID: $('#@Html.IdFor(c => c.LOAI_HINH_TAI_SAN_ID)').val(),
                    NUOC_SAN_XUAT_ID: $('#@Html.IdFor(c => c.NUOC_SAN_XUAT_ID)').val(),
                    LY_DO_BIEN_DONG_ID: $('#@Html.IdFor(c => c.LY_DO_BIEN_DONG_ID)').val(),
                    QUYET_DINH_SO: $('#@Html.IdFor(c => c.QUYET_DINH_SO)').val(),
                    QUYET_DINH_NGAY: $('#@Html.IdFor(c => c.QUYET_DINH_NGAY)').val(),
                    CHUNG_TU_SO: $('#@Html.IdFor(c => c.CHUNG_TU_SO)').val(),
                    CHUNG_TU_NGAY: $('#@Html.IdFor(c => c.CHUNG_TU_NGAY)').val(),
                    NAM_SAN_XUAT: $('#@Html.IdFor(c => c.NAM_SAN_XUAT)').val(),
                    DON_VI_BO_PHAN_ID: $('#@Html.IdFor(c => c.DON_VI_BO_PHAN_ID)').val(),
                    GHI_CHU: $('#@Html.IdFor(c => c.GHI_CHU)').val(),
                    DON_VI_ID: $('#@Html.IdFor(c => c.DON_VI_ID)').val(),
                    NGAY_NHAP: $('#@Html.IdFor(c => c.NGAY_NHAP)').val(),
                    NGAY_SU_DUNG: $('#@Html.IdFor(c => c.NGAY_SU_DUNG)').val(),
                    GIA_MUA_TIEP_NHAN: $("#giaMuaTiepNhan").val(),
                    SelectedNguonVonIds: $('#@Html.IdFor(c => c.SelectedNguonVonIds)').val(),
                    YeuCauId: $('#@Html.IdFor(c=>c.YeuCauId)').val(),
                    SoLuongNhanBan: $('#@Html.IdFor(c=>c.SoLuongNhanBan)').val(),
                    lstNguonVonModel: _lstNguonVon,
                    HOA_HONG_DE_LAI_DON_VI: $('#@Html.IdFor(c=>c.HOA_HONG_DE_LAI_DON_VI)').val(),
                    HOA_HONG_NOP_NSNN: $('#@Html.IdFor(c=>c.HOA_HONG_NOP_NSNN)').val(),
                    GIA_HOA_DON: $("#GIA_HOA_DON").val(),
                    IS_MIEN_THUE: isCheckedMienThue,
                    MIEN_THUE_SO_TIEN: $("#MIEN_THUE_SO_TIEN").val(),
                    DU_AN_ID: $('#@Html.IdFor(c=>c.DU_AN_ID)').val(),
                    PHUONG_THUC_MUA_SAM_ID: $('#PHUONG_THUC_MUA_SAM_ID').val(),
                    DON_VI_MUA_SAM_TAP_TRUNG_ID: $('#DON_VI_MUA_SAM_TAP_TRUNG_ID').val(),
                    DON_VI_CHE_DO_HACH_TOAN_ID: $("#CHE_DO_HACH_TOAN_ID").val(),
                    Checktinhkhauhao: $("#checktinhkhauhao").is(":checked"),

                    nvYeuCauChiTietModel: {
                        //HINH_THUC_MUA_SAM_ID: $("#HinhThucMuaSamId").val(),
                        MUC_DICH_SU_DUNG_ID: $("#nvYeuCauChiTietModel_MUC_DICH_SU_DUNG_ID").val(),
                        NGUYEN_GIA: $("#TongNguyenGia").val(),
                        HM_SO_NAM_CON_LAI: $("#nvYeuCauChiTietModel_HM_SO_NAM_CON_LAI").val(),
                        HM_TY_LE_HAO_MON: $("#nvYeuCauChiTietModel_HM_TY_LE_HAO_MON").val(),
                        HM_LUY_KE: $("#nvYeuCauChiTietModel_HM_LUY_KE").val(),
                        HM_GIA_TRI_CON_LAI: $("#nvYeuCauChiTietModel_HM_GIA_TRI_CON_LAI").val(),
                        KH_NGAY_BAT_DAU: $("#nvYeuCauChiTietModel_KH_NGAY_BAT_DAU").val(),
                        PHUONG_PHAP_TINH_KHAU_HAO_ID: $("#nvYeuCauChiTietModel_PHUONG_PHAP_TINH_KHAU_HAO_ID").val(),
                        KH_THANG_CON_LAI: $("#nvYeuCauChiTietModel_KH_THANG_CON_LAI").val(),
                        KH_GIA_TINH_KHAU_HAO: $("#nvYeuCauChiTietModel_KH_GIA_TINH_KHAU_HAO").val(),
                        KH_GIA_TRI_TRICH_THANG: $("#NVYeuCauChiTietModel_KH_GIA_TRI_TRICH_THANG").val(),
                        KH_LUY_KE: $("#nvYeuCauChiTietModel_KH_LUY_KE").val(),
                        KH_CON_LAI: $("#nvYeuCauChiTietModel_KH_CON_LAI").val(),
                        KH_TY_LE_NGUYEN_GIA_KHAU_HAO: $("#nvYeuCauChiTietModel_KH_TY_LE_NGUYEN_GIA_KHAU_HAO").val(),
                        KH_TY_LE: $("#KH_TiLe").val(),
                        KH_THANG_THEO_QD: $("#KH_thoi_han_su_dung").val(),
                        KH_NGAY_BAT_DAU: $("#nvYeuCauChiTietModel_KH_NGAY_BAT_DAU").val(),
                        DAT_GIA_TRI_QUYEN_SD_DAT: $("#GiaTriQSDDat").val(),
                        HMKH_GIA_TRI_CON_LAI: $("#nvYeuCauChiTietModel_HMKH_GIA_TRI_CON_LAI").val(),
                        lstHienTrang: _lstHienTrang,
                    },
                    taisandatModel: {
                        DIA_CHI: $("#taisandatModel_DIA_CHI").val(),
                        //DIA_BAN_ID: diabanid,
                        //DIA_BAN_ID: $("#taisandatModel_XaId").val(),
                        DIEN_TICH: $("#taisandatModel_DAT_DIEN_TICH").val(),
                        DIEN_TICH_XAY_NHA: $("#taisandatModel_DIEN_TICH_XAY_NHA").val(),
                        HS_CNQSD_SO: $("#taisandatModel_HS_CNQSD_SO").val(),
                        HS_CNQSD_NGAY: $("#taisandatModel_HS_CNQSD_NGAY").val(),
                        HS_QUYET_DINH_GIAO_SO: $("#taisandatModel_HS_QUYET_DINH_GIAO_SO").val(),
                        HS_QUYET_DINH_GIAO_NGAY: $("#taisandatModel_HS_QUYET_DINH_GIAO_NGAY").val(),
                        HS_CHUYEN_NHUONG_SD_SO: $("#taisandatModel_HS_CHUYEN_NHUONG_SD_SO").val(),
                        HS_CHUYEN_NHUONG_SD_NGAY: $("#taisandatModel_HS_CHUYEN_NHUONG_SD_NGAY").val(),
                        HS_QUYET_DINH_CHO_THUE_SO: $("#taisandatModel_HS_QUYET_DINH_CHO_THUE_SO").val(),
                        HS_QUYET_DINH_CHO_THUE_NGAY: $("#taisandatModel_HS_QUYET_DINH_CHO_THUE_NGAY").val(),
                        HS_HOP_DONG_CHO_THUE_SO: $("#taisandatModel_HS_HOP_DONG_CHO_THUE_SO").val(),
                        HS_HOP_DONG_CHO_THUE_NGAY: $("#taisandatModel_HS_HOP_DONG_CHO_THUE_NGAY").val(),
                        HS_PHAP_LY_KHAC: $("#taisandatModel_HS_PHAP_LY_KHAC").val(),
                        HS_PHAP_LY_KHAC_NGAY: $("#taisandatModel_HS_PHAP_LY_KHAC_NGAY").val(),
                        TinhId: $("#taisandatModel_TinhId").val(),
                        HuyenId: $("#taisandatModel_HuyenId").val(),
                        XaId: $("#taisandatModel_XaId").val(),
                        QuocGiaId: $("#taisandatModel_QuocGiaId").val()
                    },
                    taisanOtoModel: {
                        //BIEN_KIEM_SOAT: $("#taisanOtoModel_BIEN_KIEM_SOAT").val(),
                        TAI_TRONG: $("#taisanOtoModel_TAI_TRONG").val(),
                        IsPhuongTienVanTai: $("#taisanOtoModel_IsPhuongTienVanTai").val(),
                        CHUC_DANH_ID: $("#taisanOtoModel_CHUC_DANH_ID").val(),
                        LIST_CHUC_DANH_ID: LIST_CHUC_DANH_IDs,
                        SelectedChucDanhIds: $('#SelectedChucDanhIds').val(),
                        DUNG_TICH: $("#taisanOtoModel_DUNG_TICH").val(),
                        SO_KHUNG: $("#taisanOtoModel_SO_KHUNG").val(),
                        SO_CHO_NGOI: $("#taisanOtoModel_SO_CHO_NGOI").val(),
                        SO_MAY: $("#taisanOtoModel_SO_MAY").val(),
                        NHAN_XE_ID: $("#taisanOtoModel_NHAN_XE_ID").val(),
                        CONG_XUAT: $("#taisanOtoModel_CONG_XUAT").val(),
                        SO_CAU_XE: $("#taisanOtoModel_SO_CAU_XE").val(),
                        DONG_XE_ID: $("#taisanOtoModel_DONG_XE_ID").val(),
                        GCN_DANG_KY: $("#taisanOtoModel_GCN_DANG_KY").val(),
                        CO_QUAN_CAP_DANG_KY: $("#taisanOtoModel_CO_QUAN_CAP_DANG_KY").val(),
                        NGAY_DANG_KY: $("#taisanOtoModel_NGAY_DANG_KY").val(),

                    },
                    taisannhaModel: {
                        TAI_SAN_DAT_ID: $("#taisannhaModel_TAI_SAN_DAT_ID").val(),
                        DIEN_TICH_XAY_DUNG: $("#taisannhaModel_DIEN_TICH_XAY_DUNG").val(),
                        DIEN_TICH_SAN_XAY_DUNG: $("#taisannhaModel_DIEN_TICH_SAN_XAY_DUNG").val(),
                        NHA_DIA_CHI: $("#taisannhaModel_NHA_DIA_CHI").val(),
                        NAM_XAY_DUNG: $("#taisannhaModel_NAM_XAY_DUNG").val(),
                        NHA_SO_TANG: $("#taisannhaModel_NHA_SO_TANG").val(),
                        isQuanLyDat: $('input[name=isQuanLyDatName]:checked').val(),
                        NHA_TinhId: $("#taisannhaModel_NHA_TinhId").val(),
                        NHA_HuyenId: $("#taisannhaModel_NHA_HuyenId").val(),
                        NHA_XaId: $("#taisannhaModel_NHA_XaId").val(),
                        NHA_QuocGiaId: $("#taisannhaModel_NHA_QuocGiaId").val()

                    },
                    taisanmaymocModel: {
                        THONG_SO_KY_THUAT: $("#taisanmaymocModel_THONG_SO_KY_THUAT").val(),
                        THONG_SO_KY_HIEU: $("#taisanmaymocModel_THONG_SO_KY_HIEU").val(),
                    },
                    taisanvohinhModel: {
                        THONG_SO_KY_THUAT: $("#taisanvohinhModel_THONG_SO_KY_THUAT").val(),
                    },
                    taisanClnModel: {
                        //NAM_SINH:$("#NAM_SINH").val(),
                    },
                    taisanVktModel: {
                        VKT_DIEN_TICH: $("#taisanVktModel_VKT_DIEN_TICH").val(),
                        THE_TICH: $("#taisanVktModel_THE_TICH").val(),
                        CHIEU_DAI: $("#taisanVktModel_CHIEU_DAI").val(),
                    }

                }
    @*if (@Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC) || @Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.OTO)) {
                    _data.taisanOtoModel = null;
                    }*@

                                                                                                                                if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.OTO)) {
                    _data.taisanOtoModel.TAI_SAN_ID = $('#@Html.IdFor(c => c.ID)').val();
                    _data.taisanOtoModel.LOAI_TAI_SAN_ID = $('#@Html.IdFor(c => c.LOAI_TAI_SAN_ID)').val();
                    _data.taisanOtoModel.BIEN_KIEM_SOAT = $("#taisanOtoModel_Pre_BIEN_KIEM_SOAT").val() + "-" + $("#taisanOtoModel_Suff_BIEN_KIEM_SOAT").val();
                    if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC)) {
                        _data.taisanOtoModel.IsPhuongTienVanTai = true;
                    }
                }
                else if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.DAT)) {
                    _data.taisandatModel.DIA_BAN_ID = this.checkdiaban();
                    //_data.TEN = $("#taisandatModel_DIA_CHI").val();
                    _data.NGAY_SU_DUNG = $('#@Html.IdFor(c => c.NGAY_NHAP)').val();
                    _data.taisandatModel.TAI_SAN_ID = $('#@Html.IdFor(c => c.ID)').val();
                    _data.nvYeuCauChiTietModel.HM_GIA_TRI_CON_LAI = $("#TongNguyenGia").val();
                } else if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.NHA)) {
                    _data.taisannhaModel.DIA_BAN_ID = this.checkdiabanNha();
                }
                if (@Model.IsBanQuanLyDuAn.ToString().ToLower() == true) {
                    _data.IsBanQuanLyDuAn = true;
                } else {
                    _data.IsBanQuanLyDuAn = false;
                }
                if ((@Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAT) && @Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) && maLyDo == '@(enum_LY_DO_BIEN_DONG.KIEM_KE_PHAT_HIEN_THUA)') {
                    _data.HM_TY_LE = $('#@Html.IdFor(c=>c.HM_TY_LE)').val();
                    _data.HM_SO_NAM_CON_LAI = $('#@Html.IdFor(c=>c.HM_SO_NAM_CON_LAI)').val();
                }
    @*var array = JSON.parse('@GS.Core.Domain.DanhMuc.enumLY_DO_MUA_SAM_MUA_MOI.ToSelectist()');
                    var n = array.includes(lyDoTangId);*@
                                                                                                                                if (maLyDo == '@(enum_LY_DO_BIEN_DONG.MUA_SAM)') {
                    _data.nvYeuCauChiTietModel.HINH_THUC_MUA_SAM_ID = $('#@Html.IdFor(c=>c.HinhThucMuaSamId)').val();
                }
                //console.log(_data);
                data = _data;

            });
            return data;
        }

        updateTaiSanDat() {
            debugger;
            var COrUTaiSanJS = this;
            COrUTaiSanJS.CheckNguyenGiaTSQL();
            for (var propertyName in this.fullValid) {
                if (this.fullValid[propertyName] == true) {
                    ShowErrorMessage("Dữ liệu chưa phù hợp, mời kiểm tra lại dữ liệu!!");
                    return;
                }
            }
            //this : trỏ tới class CreateOrUpdateTaiSanJS

            bootbox.dialog({
                //title: "Đề nghị đơn vị kiểm tra kỹ thông tin trước khi lưu:",
                message: '<p style ="color:black">Bạn có chắc chắn lưu tài sản không?</p>',
                size: 'large',
                onEscape: true,
                backdrop: true,
                buttons: {
                    fee: {
                        label: 'Đồng ý',
                        className: 'btn-primary',
                        callback: function (result) {
                            if (result) {
                                var continueEdit = false;
                                var _data = COrUTaiSanJS.addData();
                                var ajaxRequest = ajaxPost(_data, "/TaiSan/Edit", false);

                                ajaxRequest.done(function (data) {
                                    if (CheckValidMessageReturn(data)) {
                                        //SaveThuocTinhTaiSan(data.ObjectInfo.ID,'/TaiSan/List');
                                        ShowSuccessMessage(data.Message);
                                        if (continueEdit && data.ObjectInfo.LOAI_HINH_TAI_SAN_ID == @((int)GS.Core.Domain.DanhMuc.enumLOAI_HINH_TAI_SAN.DAT))
                                            location.href = '/TaiSan/Edit?guid=' + data.ObjectInfo.GUID;
                                        else {
                                            if (data.ObjectInfo.DU_AN_ID > 0) {
                                                location.href = '/TaiSan/List?pageIndex=0&isDanhSachTSDA=true';
                                            } else {

                                                location.href = '/TaiSan/List?pageIndex=0&isDanhSachTSDA=false';
                                            }
                                        }
                                    }
                                }).fail(
                                    function (xhr, ajaxOptions, thrownError) {
                                        console.log("error: " + thrownError);
                                    });
                            }
                        }
                    },
                    fi: {
                        label: 'Thêm nhà trên đất',
                        className: 'btn-info',
                        callback: function (result) {
                            if (result) {
                                var continueEdit = false;
                                var _data = COrUTaiSanJS.addData();
                                var ajaxRequest = ajaxPost(_data, "/TaiSan/Edit", false);

                                ajaxRequest.done(function (data) {
                                    if (CheckValidMessageReturn(data)) {
                                        //SaveThuocTinhTaiSan(data.ObjectInfo.ID,'/TaiSan/List');
                                        ShowSuccessMessage(data.Message);
                                        var datId = $("#ID").val();
                                        var diachidat = $("#taisandatModel_DIA_CHI").val();
                                        var _url = "@(Url.Action("_TaiSanNhaTheoDat", "TaiSan"))?taiSanDatID=" + datId + "&diaChiDat=" + diachidat + "&isTangMoi=@Model.isTangMoi";
                                        OpenModalManual("Thêm mới tài sản nhà", _url, 80);
                                    }
                                }).fail(function (xhr, ajaxOptions, thrownError) {
                                    console.log("error: " + thrownError);
                                });

                            }
                        }
                    },
                    cancel: {
                        label: 'Hủy',
                    },
                }
            })
        }

        updateTaiSan() {
            var COrUTaiSanJS = this;
            // check loại tài sản TSQL như TSCĐ có nguyên giá >= 5tr và < 10tr
            COrUTaiSanJS.messageAlert = "";
            COrUTaiSanJS.CheckNguyenGiaTSQL();
            let messageAlert = "";
            //check valid
            // check valid chức danh
            let lts_oto = $("#LOAI_TAI_SAN_ID").data("kendoDropDownList");
            let lhts = '@Model.LOAI_HINH_TAI_SAN_ID'
            if (lts_oto) {
                if (lhts == '@((int)enumLOAI_HINH_TAI_SAN.OTO)') {

                    let _data = {
                        LoaiTaiSanId: lts_oto.value()
                    };
                    let _url = '@Url.Action("CheckLoaiOtoId", "LoaiTaiSan")';
                    let ajaxGetLoaiOto = $.ajax({
                        url: _url,
                        type: "POST",
                        data: _data,
                        async: false,

                    })
                    ajaxGetLoaiOto.done((LoaiOTO) => {
                        if (LoaiOTO == @((int)enumLoaiXe.XeChucDanh)) {
                            let chucDanh = $('#taisanOtoModel_CHUC_DANH_ID').data("kendoDropDownList");
                            if (chucDanh) {
                                if (chucDanh.value() == "" || chucDanh.value() == null) {
                                    this.fullValid.Oto_ChucDanh = true;
                                    $('#span_chucDanhId').show();
                                } else {
                                    this.fullValid.Oto_ChucDanh = false;
                                    $('#span_chucDanhId').hide();
                                }
                            }
                        } else {
                            this.fullValid.Oto_ChucDanh = false;
                            $('#span_chucDanhId').hide();
                        }

                    })
                } else if (lhts == '@((int)enumLOAI_HINH_TAI_SAN.NHA)') {
                    let valueCheck = $('input[name=isQuanLyDatName]:checked').val();
                    //nếu là quản lý đất thì cho chọn đất
                    if (valueCheck == "true") {
                        //bắt phải chọn đất
                        this.fullValid.DiaChi_TS_Nha = false;

                    }
                    //else {
                    //    let IdXa = $('#taisannhaModel_NHA_XaId').val();
                    //    if (IdXa <= 0) this.fullValid.DiaChi_TS_Nha = true;
                    //    else this.fullValid.DiaChi_TS_Nha = false;
                    //}
                }
                else {
                    this.fullValid.Oto_ChucDanh = false;
                    $('#span_chucDanhId').hide();
                }

            }


            for (var propertyName in this.fullValid) {

                if (this.fullValid[propertyName] == true) {
                    debugger;
                    ShowErrorMessage("Dữ liệu chưa phù hợp, mời kiểm tra lại dữ liệu!!");
                    return;
                }
            }
            //
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.OTO)) {
                COrUTaiSanJS.checkDinhMucOto();
            }

            COrUTaiSanJS.messageAlert = COrUTaiSanJS.messageAlert + COrUTaiSanJS.mesageGTCLWhenSave();

            //this : trỏ tới class CreateOrUpdateTaiSanJS

            bootbox.confirm({
                title: "Đề nghị đơn vị kiểm tra kỹ thông tin trước khi lưu:",
                message: COrUTaiSanJS.messageAlert,
                className: 'bootbox-sm',
                buttons: {
                    confirm: {
                        label: 'Đồng ý',
                        className: 'btn-primary savedongy',
                    },
                    cancel: {
                        label: 'Hủy',
                    },
                },
                callback: function (result) {
                    if (result) {
                        $(".savedongy").prop('disabled', true);
                        var continueEdit = false;
                        var _data = COrUTaiSanJS.addData();
                        var ajaxRequest = ajaxPost(_data, "/TaiSan/Edit", false);
                        ajaxRequest.done(function (data) {
                            if (CheckValidMessageReturn(data)) {
                                //SaveThuocTinhTaiSan(data.ObjectInfo.ID,'/TaiSan/List');
                                ShowSuccessMessage(data.Message);
                                if (continueEdit && data.ObjectInfo.LOAI_HINH_TAI_SAN_ID == @((int)GS.Core.Domain.DanhMuc.enumLOAI_HINH_TAI_SAN.DAT))
                                    location.href = '/TaiSan/Edit?guid=' + data.ObjectInfo.GUID;
                                else {
                                    if (data.ObjectInfo.DU_AN_ID > 0) {
                                        location.href = '/TaiSan/List?pageIndex=0&isDanhSachTSDA=true';
                                    } else {

                                        location.href = '/TaiSan/List?pageIndex=0&isDanhSachTSDA=false';
                                    }
                                }
                            }
                        }).fail(function (xhr, ajaxOptions, thrownError) {
                            console.log("error: " + thrownError);
                        });
                    }
                }
            });
        }
        /**
         * valid ngày nhập và ngày sử dụng.
         * Note: chưa maintance
         * */
        compareDate(e) {
            //selectorChange, selectorCompare, data_valmsg_for, valmsg
            var valueChange = $(e.data.selectorChange).data("kendoDatePicker").value();
            var valueCompare = $(e.data.selectorCompare).data("kendoDatePicker").value();
            if (valueChange != null && valueCompare != null) {
                if (valueChange > valueCompare) {
                    showInvalidMessage(e.data.data_valmsg_for, e.data.valmsg);
                    this.fullValid.NgaySD_And_NgayNhap = false;
                    this.checkValid = false;
                }
                else {
                    hideValmsg(e.data.data_valmsg_for);
                    this.fullValid.NgaySD_And_NgayNhap = true;
                    this.checkValid = true;
                }
            }
        }
        /**
         * valid ngày nhập và ngày sử dụng.
         * Note: chưa maintance
         * */
        compareDateNgaySDandNgayTang(e) {

            let _data = {
                selectorChange: '#NGAY_SU_DUNG',
                selectorCompare: '#NGAY_NHAP',
                data_valmsg_for: 'NGAY_SU_DUNG',
                valmsg: 'Ngày sử dụng phải nhỏ hơn hoặc bằng ngày tăng.'
            };
            if (@Model.isTangMoi.ToString().ToLower() == false) {
                _data.valmsg = 'Ngày sử dụng phải nhỏ hơn hoặc bằng ngày kê khai.';
            }
            //selectorChange, selectorCompare, data_valmsg_for, valmsg
            var valueChange = $(_data.selectorChange).data("kendoDatePicker").value();
            var valueCompare = $(_data.selectorCompare).data("kendoDatePicker").value();
            if (valueChange != null && valueCompare != null) {
                if (valueChange > valueCompare) {
                    showInvalidMessage(_data.data_valmsg_for, _data.valmsg);
                    this.fullValid.NgaySD_And_NgayNhap = true;
                    this.checkValid = true;
                }
                else {
                    hideValmsg(_data.data_valmsg_for);
                    this.fullValid.NgaySD_And_NgayNhap = false;
                    this.checkValid = false;
                }
            }
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.NHA)) {

                var namXayDungNha = ConvertToNumber("#taisannhaModel_NAM_XAY_DUNG");
                var ngaysudung = $("#NGAY_SU_DUNG").data("kendoDatePicker").value();
                if (ngaysudung != null && namXayDungNha <= ngaysudung.getFullYear()) {
                    $("#checkNamXayDung").hide();
                    this.fullValid.NamXayDung = false;
                } else {
                    $("#checkNamXayDung").show();
                    this.fullValid.NamXayDung = true;
                }
            }
        }

        compareDateNgayKHandNgaySD(e) {
            let _data = {
                selectorChange: '#nvYeuCauChiTietModel_KH_NGAY_BAT_DAU',
                selectorCompare: '#NGAY_SU_DUNG',
                data_valmsg_for: 'nvYeuCauChiTietModel.KH_NGAY_BAT_DAU',
                valmsg: 'Ngày khấu hao phải lớn hơn hoặc bằng ngày sử dụng.'
            };
            //selectorChange, selectorCompare, data_valmsg_for, valmsg
            var valueChange = $(_data.selectorChange).data("kendoDatePicker").value();
            var valueCompare = $(_data.selectorCompare).data("kendoDatePicker").value();
            if (valueChange != null && valueCompare != null) {
                if (valueChange < valueCompare) {
                    showInvalidMessage(_data.data_valmsg_for, _data.valmsg);
                    this.fullValid.KHNgayBatDau_And_NgaySD = true;
                    this.checkValid = true;
                }
                else {
                    hideValmsg(_data.data_valmsg_for);
                    this.fullValid.KHNgayBatDau_And_NgaySD = false;
                    this.checkValid = false;
                }
            }
        }

        compareDateNgaySDandNgayQD(e) {
            //debugger
            let _data = {
                selectorChange: '#taisandatModel_HS_QUYET_DINH_GIAO_NGAY',
                selectorCompare: '#NGAY_SU_DUNG',
                data_valmsg_for: 'taisandatModel.HS_QUYET_DINH_GIAO_NGAY',
                valmsg: 'Ngày quyết định phải nhỏ hơn hoặc bằng ngày sử dụng.'
            };
            //selectorChange, selectorCompare, data_valmsg_for, valmsg
            var valueChange = $(_data.selectorChange).data("kendoDatePicker").value();
            var valueCompare = $(_data.selectorCompare).data("kendoDatePicker").value();
            if ($("#checkbox-hosogiayto").is(":checked") == true) {
                hideValmsg(_data.data_valmsg_for);
                this.fullValid.NgaySD_And_NgayQD = false;
                this.checkValid = false;
            }
            else {
                if (valueChange != null && valueCompare != null || valueChange != "" && valueCompare != "") {
                    if (valueChange > valueCompare) {
                        showInvalidMessage(_data.data_valmsg_for, _data.valmsg);
                        this.fullValid.NgaySD_And_NgayQD = true;
                        this.checkValid = true;
                    }
                    else {
                        hideValmsg(_data.data_valmsg_for);
                        this.fullValid.NgaySD_And_NgayQD = false;
                        this.checkValid = false;
                    }
                }
            }
        }


        checkGiaMuaTiepNhan() {
            var _data = {
                loaitaisan: $("#LOAI_TAI_SAN_ID").val(),
                chucdanh: $("#CHUC_DANH_ID").val(),
                giamua: document.getElementById("giaMuaTiepNhan").value,
                ngaysudung: $("#NGAY_SU_DUNG").val()
            }
            $.ajax({
                url: "/TaiSan/CheckGiaMuaTiepNhan",
                type: "POST",
                data: _data,
                success: function (data) {
                    var validationDisplay = document.getElementById("validateGiaMuaTiepNhan")
                    if (data.Message != "") {
                        if (validationDisplay.classList.contains("d-none")) {
                            validationDisplay.classList.toggle("d-none");
                        }
                    }
                    validationDisplay.innerText = data.Message;
                }
            })
        }
        mesageGTCLWhenSave() {
            let messageAlert = "";
            let gtcl = "";
            try {
                if (@Model.CHE_DO_HACH_TOAN_ID == 1) {
                    var gtclFormat = $('#nvYeuCauChiTietModel_HM_GIA_TRI_CON_LAI').parent().children('.k-formatted-value').attr('title');
                    if (gtclFormat) {
                        gtcl = gtclFormat.split(' ')[0];
                    }
                } else {
                    var gtclFormat = $('#nvYeuCauChiTietModel_HMKH_GIA_TRI_CON_LAI').parent().children('.k-formatted-value').attr('title');
                    if (gtclFormat) {
                        gtcl = gtclFormat.split(' ')[0];
                    }
                }

            } catch (e) {
                console.log('Lỗi tính giá trị cl formated')
                console.log(e);
            }

            let ngayNhap = $('#NGAY_NHAP').val();
            messageAlert = messageAlert + `- GTCL của tài sản tính đến ngày ${ngayNhap} là ${gtcl} đồng.`;
            return messageAlert;
        }
        checkDinhMucOto() {
            try {

                if (@Model.LOAI_HINH_TAI_SAN_ID.GetValueOrDefault() == @((int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC) || @Model.LOAI_HINH_TAI_SAN_ID.GetValueOrDefault() == @((int)enumLOAI_HINH_TAI_SAN.OTO)) {
                    let classJSThis = this;
                    let alertSoLuong = '';
                    let alertNguyenGia = '';

                    let tenChucDanh = $('#select-content-taisanOtoModel_CHUC_DANH_ID span.k-input').text();

                    let ChucDanhKenDo = $('#taisanOtoModel_CHUC_DANH_ID').data("kendoDropDownList");

                    let chucDanhId = null;
                    if (ChucDanhKenDo) {
                        chucDanhId = ChucDanhKenDo.value();
                    }
                    // tính nguyên giá: Nếu có giá trên hóa đơn thì lấy giá trên hóa đơn không thì lấy theo nguyên giá
                    let nguyenGia = 0;
                    let giaHoaDon = $('#giaMuaTiepNhan').val();

                    let lyDoTangId = $("#LY_DO_BIEN_DONG_ID").val();

                    getMaByIdLyDoTangGiam(lyDoTangId).done((maLyDo) => {
                        if (maLyDo == '@(enum_LY_DO_BIEN_DONG.MUA_SAM)') {
                            nguyenGia = giaHoaDon;
                        } else {
                            nguyenGia = $('#TongNguyenGia').val();
                        }
                    });

                    let _data1 =
                    {
                        ChucDanhId: chucDanhId,
                        LoaiTaiSanId: $('#LOAI_TAI_SAN_ID').val(),
                        NgayGhiTang: $('#NGAY_NHAP').val(),
                        NguyenGia: nguyenGia
                    }
                    let ajaxcall = $.ajax({
                        url: "/TaiSan/CheckDinhMucOto",
                        type: "POST",
                        data: _data1,
                        async: false,

                    })
                    ajaxcall.done(function (data) {
                        let soLuongVuotQua = data.ObjectInfo.SoLuongVuotQua;
                        let soTienVuotQua = data.ObjectInfo.SoTienVuotQua;
                        let soLuongDangCo = data.ObjectInfo.SoLuongDangCo;
                        let tenLoaiXe = (($('#select-content-LOAI_TAI_SAN_ID span.k-input').text()).split('-'))[1];

                        if (soLuongVuotQua < 0) {
                            debugger
                            if (chucDanhId != '' || chucDanhId != null) {
                                alertSoLuong = `- Chức danh ${tenChucDanh} đã có ${soLuongDangCo} xe ô tô.`
                            } else {
                                alertSoLuong = `- Đơn vị đã đã có ${soLuongDangCo} xe ${tenLoaiXe}.`
                            }
                        }
                        if (soTienVuotQua < 0) {
                            alertNguyenGia = '- Giá mua xe ô tô vượt quá tiêu chuẩn định mức!';
                        }
                        debugger
                        if (alertSoLuong != '') {
                            classJSThis.messageAlert = alertSoLuong + '<br>'
                        }
                        if (alertNguyenGia != '') {
                            classJSThis.messageAlert = classJSThis.messageAlert + alertNguyenGia + '<br>'
                        }
                    })
                }



            } catch (e) {
                console.log('Lỗi tại phần tính giá trị định mức ô tô ');
                console.log(e);
                return "";
            }

        }
        /**
         * check nguyên giá tài sản quản lý như tscđ khác + check nguyên giá các loại  tài sản còn lại
         * */
        CheckNguyenGiaTSQL() {
            var val = parseInt($('#TongNguyenGia').val());
            let isTSQL = '@Model.isTSQL';
            let spanValidateTSQL = $('#span_NguyenGiaTSQL');
            let spnaValidateTS10M = $('#span_NguyenGia10m');
            if (isTSQL == 'True') {
                if (spanValidateTSQL) {
                    if (val >= 10000000 || val < 5000000) {
                        spanValidateTSQL.show()
                        this.fullValid.NguyenGia_TSQL = true;
                    } else {
                        spanValidateTSQL.hide();
                        this.fullValid.NguyenGia_TSQL = false;
                    }
                }
            } else {
                if (spnaValidateTS10M) {
                    if (@Model.LOAI_HINH_TAI_SAN_ID== @((int)enumLOAI_HINH_TAI_SAN.DAT) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.NHA) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.OTO)) {
                        if (val < 1) {
                            spnaValidateTS10M.show()
                            this.fullValid.NguyenGia_10M = true;
                        } else {
                            spnaValidateTS10M.hide();
                            this.fullValid.NguyenGia_10M = false;
                        }
                    }
                    else {
                        if (val < 10000000) {
                            spnaValidateTS10M.show()
                            this.fullValid.NguyenGia_10M = true;
                        } else {
                            spnaValidateTS10M.hide();
                            this.fullValid.NguyenGia_10M = false;
                        }
                    }


                }

            }
        }
        /**
         * Tính tổng nguyên giá khi quản lý
         * */
        TinhTongNguyenGia() {
            var TotalNguyenGia = 0;
            $(".NguonVon").each(function () {
                var nguonvonId = $(this).data("idnguonvon");
                var _ValueNguonVon = ConvertToNumber("#NguonVon_" + nguonvonId);
                TotalNguyenGia = parseFloat(TotalNguyenGia) + parseFloat(_ValueNguonVon);
            });
            $("#TongNguyenGia").data("kendoNumericTextBox").value(TotalNguyenGia);
            $("#TongNguyenGia").data("kendoNumericTextBox").trigger('change');
        }
        /**
         *
         * param e:
         */
        DeselectNguonVon(e) {
            var _NguonVonId = e.dataItem.Value;
            $("#TaiSanNguonvon_" + _NguonVonId).remove();
            TinhTongNguyenGia();
        }

        loadNguonVon(e, TaiSanId) {
            var NguonVonId = e.dataItem.Value;
            $.ajax({
                url: "/TaiSan/_NguonVon?NguonVonId=" + NguonVonId + "&TaiSanId=" + TaiSanId,
                type: "GET",
                success: function (data) {
                    $("#ListNguonVon").append(data);

                },
                error: function () {
                    console.log("error");
                },
            });
        }

        loadMaTaiSanTuSinh(e) {
            var _loaiTsId = $("#LOAI_TAI_SAN_ID").value();
            var _data = {
                DonViId: $("#DON_VI_ID").val(),
                TaiSanId: $('#@Html.IdFor(c => c.ID)').val(),
                LoaiTaiSanId: _loaiTsId,
                loaiHinhTaiSanId: $("#LOAI_HINH_TAI_SAN_ID").val(),
            }
            var ajaxRequest = ajaxPost(_data, "/TaiSan/LoadMaTaiSan", false);
            ajaxRequest.done(function () {
                $("#MA").val(result);
            }).fail(function (xhr, ajaxOptions, thrownError) {
                console.log("error");
            });
        };

        /**
         * Kiểm tra nguyên giá có lớn hơn 1 Tỷ, cảnh báo
         * */
        originalPriceGreaterThan1Bill() {
            var tongNguyenGia = $("#TongNguyenGia").val();
            if (tongNguyenGia > 1000000000)
                showInvalidMessage('nvYeuCauChiTietModel.NGUYEN_GIA', 'Nguyên giá nhập vào của tài sản quá 1.000.000.000 đồng.')
            else
                hideValmsg('nvYeuCauChiTietModel.NGUYEN_GIA');
        }

        /**
    * Description: Check giá trị một đơn vị tính vkt < 30.000.000/dvt
    * */
        checkGiaTriPerDvt_vkt(e) {
            console.log(e);
            var dt = $("#taisanVktModel_VKT_DIEN_TICH").val();
            var tt = $("#taisanVktModel_THE_TICH").val();
            var cd = $("#taisanVktModel_CHIEU_DAI").val();
            if (dt > 0 || tt > 0 || cd > 0) {
                var tongNguyenGia = $("#TongNguyenGia").val();
                var dvt = 'vnd/m2';
                var giaTriDVT = 1;
                if (dt) {
                    giaTriDVT = dt;
                    dvt = 'vnd/m2';
                } else if (tt) {
                    giaTriDVT = tt;
                    dvt = 'vnd/m3';
                } else if (cd) {
                    giaTriDVT = cd;
                    dvt = 'vnd/m2';
                }
                //if (e.data.dvt) {
                //    if (e.data.dvt != null) {
                //        dvt = e.data.dvt;
                //    }
                //}
                if (tongNguyenGia != null && giaTriDVT > 0 && tongNguyenGia / giaTriDVT > 30000000) {
                    showInvalidMessage('nvYeuCauChiTietModel.NGUYEN_GIA', 'Giá trị tài sản vkt vượt quá 30.000.000' + dvt);
                } else {
                    hideValmsg('nvYeuCauChiTietModel.NGUYEN_GIA');
                }
            }
        }
        /**
         * check địa bàn form tài sản đất
         * */
        checkdiaban() {
            var diabanid = 0;
            if ($("#taisandatModel_TinhId").val() > 0)
                diabanid = $("#taisandatModel_TinhId").val();
            if ($("#taisandatModel_HuyenId").val() > 0)
                diabanid = $("#taisandatModel_HuyenId").val();
            if ($("#taisandatModel_XaId").val() > 0)
                diabanid = $("#taisandatModel_XaId").val();
            return diabanid;
        };

        checkdiabanNha() {
            var diabanid = 0;
            if ($("#taisannhaModel_NHA_TinhId").val() > 0)
                diabanid = $("#taisannhaModel_NHA_TinhId").val();
            if ($("#taisannhaModel_NHA_HuyenId").val() > 0)
                diabanid = $("#taisannhaModel_NHA_HuyenId").val();
            if ($("#taisannhaModel_NHA_XaId").val() > 0)
                diabanid = $("#taisannhaModel_NHA_XaId").val();
            return diabanid;
        };

        xoaTaiSanVuaNhap(idTS) {
            bootbox.confirm({
                message: "Bạn có chắc chắn xóa tài sản này?",
                className: 'bootbox-sm',
                buttons: {
                    confirm: {
                        label: 'Đồng ý',
                    },
                    cancel: {
                        label: 'Hủy',
                    },
                },
                callback: function (result) {
                    if (result) {
                        var url = "/TaiSan/DeleteTaiSan?id=" + idTS;
                        var taiSanDelete = ajaxGet(url);
                        taiSanDelete.done(function (result) {
                            if (result.Code == '00') {
                                ShowSuccessMessage(result.Message);
                                location.href = "@(string.Format(@"/TaiSan/List?pageIndex={0}", Model.pageIndex))";
                                //location.href="/TaiSan/List";
                            } else
                                ShowErrorMessage(result.Message);
                        }).fail(function (jqXHR, textStatus, errorThrow) {
                            console.log(textStatus + ': ' + errorThrow);
                        });
                    }
                },
            });
        }

        compareHientrang(e) {

            //selectorDienTich, data_valmsg_for, valmsg
            var total = 0;
            $(".HienTrang").each(function () {
                var _hientrangId = $(this).data("idhientrang");
                var a = $("#HienTrang_" + _hientrangId).data("kendoNumericTextBox").value();
                //var a = $("#HienTrang_" + _hientrangId).val();
                //var _Value = ConvertToNumber("#HienTrang_" + _hientrangId);
                //total = total + _Value;
                total = total + a;
            });
            var tongdientich = $(e.data.selectorDienTich).data("kendoNumericTextBox").value();
            //var tongdientich = ConvertToNumber(e.data.selectorDienTich);
            var tonghientrang = total.toFixed(2);
            if (tonghientrang != tongdientich) {
                showInvalidMessage(e.data.data_valmsg_for, e.data.valmsg);
                this.fullValid.HienTrang_Dien_tich = true;
                this.checkValid = true;
            }
            else {
                hideValmsg(e.data.data_valmsg_for);
                this.fullValid.HienTrang_Dien_tich = false;
                this.checkValid = false;
            }
        }

        checkNullOrEmptySelector(e) {
            //selectorCheck, data_valmsg_for, valmsg
            //khi kiểm tra chọn đất ở nhà
            //
            if (e.data.selectorCheck == '#taisannhaModel_NHA_DIA_CHI') {
                e.data.valmsg = $('input[name=isQuanLyDatName]:checked').val() == 'true' ? 'Phải chọn khuôn viên đất' : 'Phải nhập địa chỉ nhà'
            }

            var value = $(e.data.selectorCheck).val();
            if (value == "" || value == null) {
                showInvalidMessage(e.data.data_valmsg_for, e.data.valmsg);
                this.fullValid.Empty = true;
                this.checkValid = true;
            }
            else {
                hideValmsg(e.data.data_valmsg_for);
                this.fullValid.Empty = false;
                this.checkValid = false;
            }
        }

        chonTaiSanDatPopup() {
            var _url = "@(Url.Action("_ChonTaiSanDat", "TaiSan"))";
            OpenModalManual("Chọn khuôn viên đất", _url);
        }

        /**
         * khi thay đổi giá trị lý do tăng thì ẩn hiện một số trường dữ liệu có liên quan
         * */
        displayFieldsWhenLyDoBienDongChange() {
            var lyDoTangId = $("#LY_DO_BIEN_DONG_ID").val();
            getMaByIdLyDoTangGiam(lyDoTangId).done((maLyDo) => {
                //lý do "Mua sắm", "Mua mới"
                if (maLyDo == '@(enum_LY_DO_BIEN_DONG.MUA_SAM)') {
                    $(".hinh-thuc-mua-sam-row").removeClass('d-none');
                    $("#div_PhuongThucMuaSam").show();
                } else {
                    $(".hinh-thuc-mua-sam-row").addClass('d-none');
                    $("#div_PhuongThucMuaSam").hide();
                    $('#DON_VI_MUA_SAM_TAP_TRUNG_ID').val(null);
                    $('#PHUONG_THUC_MUA_SAM_ID').val(null);
                    hideValmsg('DON_VI_MUA_SAM_TAP_TRUNG_ID');
                }
                if (maLyDo == '@(enum_LY_DO_BIEN_DONG.KIEM_KE_PHAT_HIEN_THUA)') {
                    $(".lblNgayTang").empty();
                    $(".lblNgayTang").append("Ngày kiểm kê");
                    $(".lblNgaySuDung").removeClass("text-required");

                } else {
                    $(".lblNgayTang").empty();
                    $(".lblNgayTang").append("Ngày tăng");
                    $(".lblNgaySuDung").addClass("text-required");
                }
                //Lý do "Kiểm kê phát hiện thừa"
                if (@Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAT) && @Model.LOAI_HINH_TAI_SAN_ID != @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) {
                    if (maLyDo == '@(enum_LY_DO_BIEN_DONG.KIEM_KE_PHAT_HIEN_THUA)') {
                        $(".gtts-so-nam-con-lai-row").removeClass('d-none');
                        $(".gtts-hm-ty-le").addClass('d-none');
                    } else {
                        $(".gtts-so-nam-con-lai-row").addClass('d-none');
                        $(".gtts-hm-ty-le").removeClass('d-none');
                    }
                }
                //Lý "Tiếp nhận", lts_oto => ẩn các trường thông tin về thuế
                if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.OTO)) {
                    if (maLyDo == '@(enum_LY_DO_BIEN_DONG.TIEP_NHAN)' || maLyDo == '@(enum_LY_DO_BIEN_DONG.KIEM_KE_PHAT_HIEN_THUA)') {
                        $(".ts_oto-mien-thue-row").addClass('d-none');
                    } else {
                        $(".ts_oto-mien-thue-row").removeClass('d-none');
                    }
                }
            });
        }
        /**
         * Lấy thông tin tỷ lệ hao mòn theo loại tài sản
         * */
        getThongTinHM() {
            var loaiTaiSanId = 0;
            if (@Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.VO_HINH) || @Model.LOAI_HINH_TAI_SAN_ID == @((int)enumLOAI_HINH_TAI_SAN.DAC_THU)) {
                loaiTaiSanId = $("#LOAI_TAI_SAN_DON_VI_ID").val();
            }
            else {
                loaiTaiSanId = $("#LOAI_TAI_SAN_ID").val();
            }
            if (loaiTaiSanId > 0) {
                var getLoaiTaiSanByIdURL = "/TaiSan/GetThongTinLoaiTaiSan?loaiTaiSanId=" + loaiTaiSanId + "&loaiHinhTaiSanId=@Model.LOAI_HINH_TAI_SAN_ID";
                var loaiTaiSan = ajaxGet(getLoaiTaiSanByIdURL, true);
                loaiTaiSan.done(function (result) {
                    if (result.Code == "00" && result.ObjectInfo != null) {
                        var loaiTS = result.ObjectInfo;
                        var hm_tyLe = $("#HM_TY_LE").data("kendoNumericTextBox");
                        var kh_tyLe = $("#KH_TiLe").data("kendoNumericTextBox");
                        var KH_thoi_han_su_dung = $("#KH_thoi_han_su_dung").data("kendoNumericTextBox");
                        if (hm_tyLe) {
                            if (loaiTS.HM_TY_LE == null) {
                                loaiTS.HM_TY_LE = 0;
                            }
                            hm_tyLe.value(loaiTS.HM_TY_LE);
                        }
                        if (kh_tyLe) {
                            if (loaiTS.KH_TY_LE == null) {
                                loaiTS.KH_TY_LE = 0;
                            }
                            //nếu loaitaisanmodel = null -> không có dữ liệu HN KH cũ lấy theo change
                            //nếu có dữ liệu thuộc update tài sản sử dụng dữ liệu sẵn có từ db
                            if ('@isLoaiTaiSanModelNull' == 'False') {
                                kh_tyLe.setOptions({ value: '@iKH_TY_LE' });
                            } else {
                                kh_tyLe.setOptions({ value: loaiTS.KH_TY_LE });
                            }
                        }
                        if (KH_thoi_han_su_dung) {
                            if (loaiTS.KH_THOI_HAN_SU_DUNG == null) {
                                loaiTS.KH_THOI_HAN_SU_DUNG = 0;
                            }
                            //nếu loaitaisanmodel = null -> không có dữ liệu HN KH cũ lấy theo change
                            //nếu có dữ liệu thuộc update tài sản sử dụng dữ liệu sẵn có từ db
                            if ('@isLoaiTaiSanModelNull' == 'False') {
                                KH_thoi_han_su_dung.value('@iKH_THOI_HAN_SU_DUNG');
                            } else {
                                KH_thoi_han_su_dung.setOptions({ value: loaiTS.KH_THOI_HAN_SU_DUNG });
                            }
                        }
                    }
                }).fail(function (jqXHR, textStatus, errorThrown) {
                    // If fail
                    console.log(textStatus + ': ' + errorThrown);
                });
            } else
                return null;
        }
    }
    $(function () {
        $('#globalModalIframe').on('hide.bs.modal', function (event) {
            $("#globalModalIframeContent").html(null);
        });
    })
</script>
<script>
    $(document).ready(function () {
        var ListLoaiHinhTaiSan = ['@((int)enumLOAI_HINH_TAI_SAN.NHA)', '@((int)enumLOAI_HINH_TAI_SAN.DAT)', '@((int)enumLOAI_HINH_TAI_SAN.TAI_SAN_VAT_KIEN_TRUC)'];
        var loaiHinhTaiSan = '@Model.LOAI_HINH_TAI_SAN_ID';
        if (!ListLoaiHinhTaiSan.includes(loaiHinhTaiSan)) {
            $("#DonViMuaSamInput").kendoComboBox({
                placeholder: "Chọn đơn vị mua sắm tập trung...",
                dataTextField: "TEN",
                dataValueField: "ID",
                filter: "contains",
                autoBind: true,
                minLength: 3,
                dataSource: {
                    type: "json",
                    serverFiltering: true,
                    transport: {
                        read: {
                            url: "/Donvi/SearchDonViMuaSam",
                            data: SearchDonViData
                        },
                    },
                },
                change: onDonViChange
            });
            function onDonViChange() {
                var value;
                var valueInput = this.value();
                if (isNaN(parseFloat(valueInput))) {
                    value = $("#DON_VI_MUA_SAM_TAP_TRUNG_ID").val();
                } else {
                    value = this.value();
                    $("#DON_VI_MUA_SAM_TAP_TRUNG_ID").val(value);
                }

            }
            function SearchDonViData() {
                var _data = { TenDonVi: $("#DonViMuaSamInput").data("kendoComboBox").text() };
                return _data;
            }
            function showOrHideDonViMuaSam(hinhThucMuaSam) {
                if (hinhThucMuaSam == '@((int)enumPHUONG_THUC_MUA_SAM.TapTrung)') {
                    $('.DonViMuaSam').each(function () {
                        $(this).show();
                    });
                } else {
                    $('.DonViMuaSam').each(function () {
                        $(this).hide();
                    });
                    var input = $("#DonViMuaSamInput").data("kendoComboBox");
                    if (input) {
                        input.text("");
                    }
                    $('#DON_VI_MUA_SAM_TAP_TRUNG_ID').val(null);
                    hideValmsg('DON_VI_MUA_SAM_TAP_TRUNG_ID');
                }
            }
            $('#PHUONG_THUC_MUA_SAM_ID').on('change', function () {
                var value = $(this).val();
                showOrHideDonViMuaSam(value);
            })
            $('#PHUONG_THUC_MUA_SAM_ID').change();
        }


    });

</script>

<style>
    .bootbox .modal-title {
        font-size: 1.3rem;
    }

    .bootbox-body {
        color: red;
    }
</style>

@switch (Model.LOAI_HINH_TAI_SAN_ID)
{
    case (int)enumLOAI_HINH_TAI_SAN.DAT:
        @await Html.PartialAsync("_TaiSanDat", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.NHA:
        @await Html.PartialAsync("_TaiSanNha", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.TAI_SAN_VAT_KIEN_TRUC:
        @await Html.PartialAsync("_TaiSanVKT", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.OTO:
        @await Html.PartialAsync("_TaiSanOto", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.TAI_SAN_MAY_MOC_THIET_BI:
    case (int)enumLOAI_HINH_TAI_SAN.HUU_HINH_KHAC:
    case (int)enumLOAI_HINH_TAI_SAN.DAC_THU:
        @await Html.PartialAsync("_TaiSanMayMocThietBi", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.PHUONG_TIEN_KHAC:
        @await Html.PartialAsync("_TaiSanPhuongTienVanTai", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.VO_HINH:
        @await Html.PartialAsync("_TaiSanVoHinh", Model)
        ;
        break;
    case (int)enumLOAI_HINH_TAI_SAN.TAI_SAN_CAY_LAU_NAM_SVLV:
        @await Html.PartialAsync("_TaiSanCln", Model)
        ;
        break;
    default:
        break;
}

